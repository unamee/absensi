<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <meta name="csrf-token" content="{{ csrf_token }}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>

    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
    />

    <!-- Font Awesome (optional, kamu sudah pakai) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <style>
      body {
        overflow-x: hidden;
      }
      .sidebar {
        min-height: 100vh;
        background-color: #343a40;
        color: #fff;
        transition: margin-left 0.3s ease;
      }
      .sidebar a {
        color: #fff;
        text-decoration: none;
      }
      .sidebar .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      /* Collapsed sidebar */
      .sidebar.collapsed {
        margin-left: -250px;
      }
      .content-area {
        transition: margin-left 0.3s ease;
      }
      .content-area.expanded {
        margin-left: 0;
      }
      /* For dropdown animation */
      .collapse.show {
        transition: height 0.3s ease;
      }

      @media print {
        .btn {
          display: none;
        }
      }
    </style>
  </head>
  <body hx-ext="response-targets">
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 sidebar p-3">
          <h4 class="text-center mb-4">Menu</h4>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a
                class="nav-link"
                href="#"
                hx-get="{% url 'checkin' %}"
                hx-target="#content"
                hx-swap="innerHTML"
              >
                üü¢ Check-in
              </a>
            </li>

            <li class="nav-item">
              <a
                class="nav-link"
                href="#"
                hx-get="{% url 'checkout' %}"
                hx-target="#content"
                hx-swap="innerHTML"
              >
                üî¥ Check-out
              </a>
            </li>

            <!-- Dropdown Menu -->
            <li class="nav-item">
              <a
                class="nav-link"
                data-bs-toggle="collapse"
                href="#reportsMenu"
                role="button"
                aria-expanded="false"
              >
                üìä Dashboard ‚ñæ
              </a>
              <div class="collapse" id="reportsMenu">
                <ul
                  class="btn-toggle-nav list-unstyled fw-normal pb-1 small ps-3"
                >
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'dashboard-employee' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      >Monitoring</a
                    >
                  </li>
                </ul>
              </div>
              <div class="collapse" id="reportsMenu">
                <ul
                  class="btn-toggle-nav list-unstyled fw-normal pb-1 small ps-3"
                >
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'break_scan' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      >Ijin Keluar / Masuk</a
                    >
                  </li>
                </ul>
              </div>
            </li>
            <!-- Hanya tampil jika bukan user 'security' -->
            {% if request.user.username != "security" %}
            <!-- Dropdown Menu -->
            <li class="nav-item">
              <a
                class="nav-link"
                data-bs-toggle="collapse"
                href="#reportsMenu"
                role="button"
                aria-expanded="false"
              >
                üìä Master ‚ñæ
              </a>
              <div class="collapse" id="reportsMenu">
                <ul
                  class="btn-toggle-nav list-unstyled fw-normal pb-1 small ps-3"
                >
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'employee' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      >Employee</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'jabatan' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      >Jabatan</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'dept' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      >Department</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'machine_list' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      >Machine</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'shift_list' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      >Shift</a
                    >
                  </li>

                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'attendance_list' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                    >
                      Attendance
                    </a>
                  </li>
                </ul>
              </div>
            </li>

            <!-- Dropdown Menu -->
            <li class="nav-item">
              <a
                class="nav-link"
                data-bs-toggle="collapse"
                href="#reportsMenu"
                role="button"
                aria-expanded="false"
              >
                üìä Reports ‚ñæ
              </a>
              <div class="collapse" id="reportsMenu">
                <ul
                  class="btn-toggle-nav list-unstyled fw-normal pb-1 small ps-3"
                >
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="{% url 'attendance_report' %}"
                      hx-target="#content"
                      hx-swap="innerHTML"
                    >
                      üìÖ Laporan Absensi
                    </a>
                  </li>
                  <li>
                    <a
                      href="#"
                      class="nav-link"
                      hx-get="/reports/monthly/"
                      hx-target="#content"
                      hx-swap="innerHTML"
                      >Monthly</a
                    >
                  </li>
                </ul>
              </div>
            </li>
            {% endif %}
            <li class="nav-item mt-3">
              <a href="{% url 'logout' %}" class="btn btn-danger w-100"
                >Logout</a
              >
            </li>
          </ul>
        </nav>

        <!-- Main Content -->
        <main
          id="content-area"
          class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4 content-area"
        >
          <!-- Sidebar toggle button -->
          <button id="toggleBtn" class="btn btn-outline-secondary mb-3">
            ‚ò∞ Toggle Menu
          </button>

          {% comment %}
          <h2>PT. WinnerSumbiri Knitting</h2>
          {% endcomment %}
          <div id="content" class="mt-4">
            <div class="alert alert-info">
              Welcome, {{ request.user.username }}!
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const toggleBtn = document.getElementById("toggleBtn");
      const sidebar = document.getElementById("sidebar");
      const contentArea = document.getElementById("content-area");

      toggleBtn.addEventListener("click", () => {
        sidebar.classList.toggle("collapsed");
        contentArea.classList.toggle("expanded");
      });
    </script>

    <!-- machine -->

    <div id="htmx-loader" class="text-center mt-3" style="display: none">
      ‚è≥ <small>Sedang memuat data...</small>
    </div>

    <script>
      document.body.addEventListener("htmx:beforeRequest", function () {
        const loader = document.getElementById("htmx-loader");
        if (loader) loader.style.display = "block";
      });
      document.body.addEventListener("htmx:afterRequest", function () {
        const loader = document.getElementById("htmx-loader");
        if (loader) loader.style.display = "none";
      });

      document.body.addEventListener("htmx:afterSwap", function (evt) {
        const modalEl = document.querySelector(".modal.show");
        if (modalEl) {
          const modal = bootstrap.Modal.getInstance(modalEl);
          if (modal) modal.hide();
        }
      });
    </script>

    <!-- hapus backdrop hitam -->
    <script>
      document.body.addEventListener("htmx:afterSwap", function (evt) {
        // Tutup modal jika ada
        const modalEl = document.querySelector(".modal.show");
        if (modalEl) {
          const modal = bootstrap.Modal.getInstance(modalEl);
          if (modal) modal.hide();
        }

        // Hapus backdrop yang tersisa
        document
          .querySelectorAll(".modal-backdrop")
          .forEach((el) => el.remove());
        document.body.classList.remove("modal-open"); // agar scroll aktif lagi
      });
    </script>
  </body>
</html>

<script>
  document.body.addEventListener("htmx:configRequest", (event) => {
    const token = document.querySelector('meta[name="csrf-token"]').content;
    event.detail.headers["X-CSRFToken"] = token;
  });
</script>
