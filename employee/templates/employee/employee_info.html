{% load static %}
<div class="container mt-4">
  {% if employee.employee.qr_code %}
  <div
    id="qr-section"
    class="card shadow-sm text-center p-4 mx-auto"
    style="max-width: 400px"
  >
    <div class="mb-3">
      <img
        src="{{ employee.employee.qr_code.url }}"
        alt="QR Code"
        class="img-fluid border rounded p-2 bg-light"
        style="max-width: 200px"
      />
    </div>

    <h5 class="fw-bold text-primary">QR Code Karyawan</h5>
    <hr />
    <img
      src="{{ employee.employee.photo.url }}"
      alt="Foto"
      class="img-thumbnail mb-3 d-block mx-auto"
      width="120"
    />

    <p class="mb-1">
      <strong>Nama:</strong> {{ employee.first_name }} {{ employee.last_name }}
    </p>
    <p class="mb-1">
      <strong>ID Karyawan:</strong> {{ employee.employee.id_karyawan }}
    </p>

    <div class="mt-3 d-flex justify-content-center gap-2">
      <a
        href="{{ employee.employee.qr_code.url }}"
        class="btn btn-outline-primary btn-sm"
        download
      >
        <i class="fa-solid fa-download me-1"></i> Download
      </a>
      <button class="btn btn-outline-success btn-sm" onclick="printQR()">
        <i class="fa-solid fa-print me-1"></i> Print Label
      </button>
    </div>
  </div>
  {% endif %}
</div>

<script>
  function printQR() {
    const qrSection = `
      <div class="card text-center p-3 border border-dark rounded-3" style="width: 80mm; height: 105mm; box-sizing: border-box;">
        <img src="{% static 'employee/img/logo_wsk.png' %}" alt="Logo" style="max-width: 60px; margin: 5px auto;">
        <div style="font-weight: bold; font-size: 12px; margin-bottom: 5px;">PT WinnerSumbiri Knitting Factory</div>
        <img src="{{ employee.employee.qr_code.url }}" alt="QR Code" style="max-width: 70%; margin: 10px 0;">
        <div style="font-size: 13px; margin-top: 5px;"><strong>Nama:</strong> {{ employee.first_name }} {{ employee.last_name }}</div>
        <div style="font-size: 13px;"><strong>ID:</strong> {{ employee.employee.id_karyawan }}</div>
      </div>
    `;

    const printWindow = window.open("", "_blank");
    printWindow.document.write(`
      <html>
        <head>
          <title>Print Label Karyawan</title>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
          <style>
            @page {
              size: 80mm 105mm;
              margin: 0;
            }
            body {
              font-family: "Arial", sans-serif;
              display: flex;
              justify-content: center;
              align-items: center;
              height: 100vh;
              background: #fff;
            }
            .card {
              box-shadow: none !important;
            }
          </style>
        </head>
        <body>
          ${qrSection}
          <script>
            window.onload = function() {
              window.print();
              window.onafterprint = window.close;
            }
          <\/script>
        </body>
      </html>
    `);

    printWindow.document.close();
  }
</script>
